<h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
          <div name="ExtensionAPI" data-unique="ExtensionAPI"></div><h1>Extension API</h1>
<p>The Extension API provides the ability to ‘extend’ the capability of the platform by creating your own custom annotation.</p>
<p><strong>Steps to use Extension API</strong></p>
<ol>
<li>
<p>Located in the project editor view, click on the <img alt="alt text" src="/assets/images/s-brightcove-interactivity-img/developers/widget-icon.png"> icon to open the widget library menu.
<img alt="alt text" src="/assets/images/s-brightcove-interactivity-img/developers/extension-api-4.png"></p>
</li>
<li>
<p>From here, click the HTML tab. This block of code contains all of the necessary scripts to get started. Editing the raw HTMLboiler-plate code gives you the freedom to build a custom extension or annotation tailored to your needs. <br>
<img alt="alt text" src="/assets/images/s-brightcove-interactivity-img/developers/extension-api-5.png"></p>
</li>
</ol>
<p>This example represents a good starting point:</p>
<pre class="line-numbers"><code class="language-html" translate="No">&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
      &lt;title&gt;&lt;/title&gt;
      &lt;meta charset=&quot;utf-8&quot;/&gt;
      &lt;style type=&quot;text/css&quot;&gt;
          html, body { margin: 0; padding: 0 }
      &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
      &lt;!-- HTML code goes here --&gt;

      &lt;script type=&quot;text/javascript&quot; src=&quot;//d2qrdklrsxowl2.cloudfront.net/js/hapyak-iframe.js&quot;&gt;&lt;/script&gt;
      &lt;script type=&quot;text/javascript&quot; src=&quot;//d2qrdklrsxowl2.cloudfront.net/js/hapyak.api.js&quot;&gt;&lt;/script&gt;
      &lt;script type=&quot;text/javascript&quot;&gt;
          (function () {
              /*
              Write your script code here
              */

              hapyak.context.addEventListener(&#39;data&#39;, function (variables) {
                  /*
                  Access Environment variables here
                  */
              });
          }());
      &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>

<section class="bcls-section">
  <h2 id="Player_object">Player object</h2>
  <h4>Object: <code translate="no">hapyak.context.player</code></h4>
  <h3 id="player_methods">Methods</h3>
  <h4><code translate="no">play()</code></h4>
  <p><code translate="no">hapyak.context.player.play()</code></p>
  <p>Plays the video.</p>
  <h4><code translate="no">pause()</code></h4>
  <p><code translate="no">hapyak.context.player.pause()</code></p>
  <p>Pauses the video.</p>
  <h4><code translate="no">mute()</code></h4>
  <p><code translate="no">hapyak.context.player.mute()</code></p>
  <p>Mutes the video.</p>
  <h4><code translate="no">unmute()</code></h4>
  <p><code translate="no">hapyak.context.player.unmute()</code></p>
  <p>Unmutes the video.</p>
  <h4><code translate="no">volume()</code></h4>
  <p><code translate="no">hapyak.context.player.volume()</code></p>
  <p>Passing no arguments to this function returns a number between 0 to 1 representing the current volume.</p>
  <p><code translate="no">hapyak.context.player.volume(0.5)</code></p>
  <p>Passing a number between 0-1 will set the volume of the player to that value.</p>
  <h4><code translate="no">addClass(classNames, selector)</code></h4>
  <p><code translate="no">hapyak.context.player.</code></p>
  <p>Add CSS classes on the IFRAME annotation where:</p>
  <ul>
    <li><code translate="no">classNames</code> (string or array) can be a single class e.g <code translate="no">myAwesomeClass</code> or an array of classes <code translate="no">['class1', 'class2']</code></li>
    <li><code translate="no">selector</code>  (optional) is used to target an existing class, id, or DOM element on the player element and add the class(es) to that element. If a selector is not passed in, the class will be added to the parent div within the iframe.</li>
  </ul>
  <h5>Example</h5>
<pre><code class="language-javascript" translate="No">hapyak.context.player.addClass('myClass', 'div#wrapper &gt; h1)</code></pre>
  <h4><code translate="no">removeClass(classNames, selector)</code></h4>
  <p><code translate="no">hapyak.context.player.</code></p>
  <p>Remove CSS classes on the IFRAME annotation where:</p>
  <ul>
    <li><code translate="no">classNames</code> (string or array) can be a single class e.g <code translate="no">myAwesomeClass</code> or an array of classes <code translate="no">['class1', 'class2']</code></li>
    <li><code translate="no">selector</code>  (optional) is used to target an existing class, id, or DOM element on the player element and add the class(es) to that element. If a selector is not passed in, the class will be added to the parent div within the iframe.</li>
  </ul>
  <h5>Example</h5>
<pre><code class="language-javascript" translate="No">hapyak.context.player.removeClass('myClass', 'div#wrapper &gt; .video-title')</code></pre>
  <H3>Properties</H3>
  <H4><code translate="no">paused</Code></H4>
  <p><em>READ ONLY</em></p>
  <p><code translate="no">let playerPaused = hapyak.context.player.paused</code></p>
  <p>Get whether video is paused or not.</p>
  <H4><code translate="no">duration</Code></H4>
  <p><em>READ ONLY</em></p>
  <p><code translate="no">const videoLength = hapyak.context.player.duration //duration in seconds</code></p>
  <p>Returns video duration (unit: seconds).</p>
  <H4><code translate="no">currentTime</Code></H4>
  <p><em>READ / WRITE</em></p>
  <p><code translate="no">let currentTime = hapyak.context.player.currentTime //returns time in seconds</code></p>
  <p>Can be used to Get current video time (unit: seconds).</p>
  <p><code translate="no">hapyak.context.player.currentTime = 20 //will jump to 20 seconds</code></p>
  <p>Can also be used to set the current time of the video (jump to time).</p>
  <H4><code translate="no">isEditMode</Code></H4>
  <p><em>READ ONLY</em></p>
  <p><code translate="no">hapyak.context.player.isEditMode</code></p>
  <p>Returns true if the IFRAME is being displayed inside a Brightcove Interactivity editor.</p>
  <H4><code translate="no">isEditing</Code></H4>
  <p><em>READ ONLY</em></p>
  <p><code translate="no">hapyak.context.player.isEditing</code></p>
  <p>Returns true if the IFRAME is currently being edited.</p>
</section>
<section class="bcls-section">
  <h2 id="Annotation_object">Annotation object</h2>
  <aside class="bcls-aside bcls-aside--information language-editable">
    <h3>IMPORTANT NOTE</h3>
    <p>In order to set properties, the iFrame must be visible. The following example is one recommended way to ensure that the iframe is shown prior to attempting a resize.</p>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener('iframeshow', function () {
  hapyak.context.width = document.body.querySelector('.hapyak-iframe-container').offsetWidth;
});</code></pre>
</aside>
  <h3>Methods</h3>
  <h4><code translate="no">hapyak.context.releaseGate()</code></h4>
  <p>A gate restricts the progress of a viewer in the video, requiring that they interact with an annotation prior to continuing on. In the extension api, you must explicitly state when a gate is to be relased.
  To set a gate, toggle the respective option in the edit tab on the annotation to <code translate="no">y</code> as seen in these screenshots:</p>
  <figure><img alt="edit" src="/assets/images/s-brightcove-interactivity-img/developers/edit.png"></figure>
  <figure><img alt="gate" src="/assets/images/s-brightcove-interactivity-img/developers/gate.png"></figure>
  <ul>
  <li>If the IFRAME is set to be gated, calling this method will release that gate.</li>
  </ul>
  <h3>Properties</h3>
  <h4><code translate="no">annotationData</code></h4>
  <p><em>READ ONLY</em></p>
  <p><code translate="no">hapyak.context.annotationData</code></p>
  <p>Returns list of current annotation's properties. From here we can gain access to group and project configuration elements, including group and project level css. It is good practice to maintain styling by adding your group and project level CSS to the extension. In order to return this object, you must wait for the annotation to load:</p>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener('annotationload', function(){
  console.log("annotation Data", hapyak.context.annotationData)
});</code></pre>
  <h4><code translate="no">width</code></h4>
  <p><em>READ / WRITE</em></p>
  <p><code translate="no">hapyak.context.width = pixels</code></p>
  <p>Sets or gets the width of the IFRAME element.</p>
  <h4><code translate="no">height</code></h4>
  <p><em>READ / WRITE</em></p>
  <p><code translate="no">hapyak.context.height = pixels</code></p>
  <p>Sets or gets the height of the IFRAME element.</p>

  <h3>Events</h3>
  <h4><code translate="no"></code></h4>
  <p>Events are accessed through event listeners on the hapyak.context object:</p>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("event", function () {
  //do something here
});</code></pre>
  <h4><code translate="no">annotationload</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("annotationload", function (data) {
  console.log(data)
});</code></pre>
<ul>
<li>
<p>Emitted when the current annotation loads.   </p>
</li>
<li>
<p>The object emitted by this event contains data related to the annotation, as well as group, and project configuration data.</p>
</li>
</ul>
<pre class="line-numbers"><code class="language-javascript" translate="No">{
  top: "19.999999999999993%",
  left: "20%",
  width: "60%",
  height: "60%",
  duration: 3,
  durationFormat: "seconds"
  durationValue: 3
  end: 6.2256
  groupConfig: {gates: true, minWidth: "0", iframeTimeout: 30000}
  height: "60%"
  id: "iframe1560519550307"
  left: "20%"
  projectConfig: {css: "", title: "Extension API example"},
  projectId: 284539
  projectTrackId: 575497
  start: 3.2256
  startTimeFormat: "seconds"
  startTimeValue: 3.2256
}</code></pre>
  <h4><code translate="no">loadedmetadata</code></h4>
  <pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("loadedmetadata", function (data) {
    console.log(data)
});</code></pre>
  <p>Emitted when the Brightcove Interactivity metadata has finished loading.</p>
  <h4><code translate="no">data</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("data", function (data) {
  console.log(data);
});</code></pre>
  <p>The 'data' event will fire anytime there is a change in the environment variables. This happens often. Below is an example of the object that is returned.</p>
<pre class="line-numbers"><code class="language-javascript" translate="No">{
  annotationIds: {1457229: true, 1457445: true, 1457474: true, 1457475: true}
  annotationsLoaded: true
  configuration: {gates: true, minWidth: "0", iframeTimeout: 30000,}
  projectAnnotations: {1457229: {}, 1457445: {}, 1457474: {}, 1457475: {}}
  projectConfig: {css: "", title: "Extension API example"}
  projectId: 284539
  projectName: "Extension API example"
}</code></pre>

<h4><code translate="no">iframeshow</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("iframeshow", function () {
  console.log('Iframe has appeared');
});</code></pre>
<p>Emitted when the IFRAME annotation enters its start time and is shown.</p>
<h4><code translate="no">iframehide</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("iframehide", function () {
  console.log('Iframe annotation is no longer visible');
});</code></pre>
<p>Emitted when the IFRAME annotation passes its end time and is hidden.</p>
<h4><code translate="no">timeupdate</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("timeupdate", function () {
  // prints current time of video to the console
  console.log(hapyak.context.player.currentTime);
});</code></pre>
<p>Emitted when the current video time changes, and at a regular interval while the video is playing.</p>
<h4><code translate="no">resized</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("resized", function () {
  console.log('Player is becoming smaller');
});</code></pre>
<p>Emitted when the player is resized relative to the window.</p>
<h4><code translate="no">play</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("play", function () {
  console.log("Video is currently playing");
});</code></pre>
<p>Emitted when the video begins playing.</p>
<h4><code translate="no">pause</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("pause", function () {
  console.log("Player has been paused");
});</code></pre>
<p>Emitted when the video becomes paused.</p>
<h4><code translate="no">editModeChange</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("pause", function () {
  console.log('Player has been paused');
});</code></pre>
<p>Emitted when the edit mode is changed within the Brightcove Interactivity editor.</p>
<h4><code translate="no">playerHover</code></h4>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("playerHover", function () {
  console.log('Mouse is being hovered within the player');
});</code></pre>
<p>Emitted when a hover event occurs over the player. This event as a returned value of true or false for hovering or not hovering respectively.</p>
</section>

<section class="bcls-section">
  <h2 id="tracking_object">Tracking object</h2>
  <p><code translate="no">hapyak.context.tracking.widgetAction(action, properties)</code></p>
  <p>Allows partners to track custom analytics.</p>
<pre class="line-numbers"><code class="language-javascript" translate="No">trackButton.addEventListener( "click", function () {
  hapyak.context.tracking.widgetAction('Follow', {'username': 'foobar123'});
});</code></pre>

<ul>
<li>Action: The name of the action being tracked. This can be any string.</li>
<li>Properties: Object of properties you wish to attach to this tracked action. The properties you wish to track is entirely up to you, but must be in true JSON format.</li>
<li>using the VideoJS4 Embed type provided in the share modal, you can add options to the viewer object that will allow you to see, and track your own analytics as seen below:</li>
</ul>

<pre class="line-numbers"><code class="language-html" translate="No">&lt;video id=&quot;hapyak-player-157199-8825&quot;  class=&quot;video-js vjs-default-skin&quot; width=&quot;720&quot; height=&quot;405&quot; playsinline=&quot;playsinline&quot;&gt;
  &lt;source src=&quot;https://sample.hapyak-hosted.com/group_uploads/23/16673/videos/862f7e32a9b94974b98f004ae49fa9ef/Sample-Video-with-sound.mp4&quot; type=&quot;video/mp4&quot;/&gt;
&lt;/video&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;//vjs.zencdn.net/4.8/video-js.css&quot;&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;//vjs.zencdn.net/4.8/video.js&quot;&gt;&lt;/script&gt;

&lt;script type=&quot;text/javascript&quot; src=&quot;//d2qrdklrsxowl2.cloudfront.net/js/hapyak.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
  (function () {
      var vjs = videojs(&#39;hapyak-player-157199-8825&#39;);

      hapyak.viewer({
          apiKey: &quot;12345678910111213&quot;,
          projectId: 286041,
          resetVariables: true,
          player: vjs,
          videoType: &quot;html5&quot;,
          playerType: &quot;videojs4&quot;,
          autoplay: false,
          oncustomtrackingevent: function(data) {
            console.log(&quot;custom Data&quot;, data)
          }
      });
  })();
&lt;/script&gt;</code></pre>
<p>For more information on the viewer object check out <a href="/interactivity/embed-api/reference.html#viewer_api">this document</a>.</p>
</section>

<section class="bcls-section">
  <h2 id="session_variables">Session variables</h2>
  <p>These variables only exists during the session. Setting variables via the Extension API is functionally equivalent to passing in a "variables" object on the Viewer.</p>
  <p>OBJECT: <code translate="no">hapyak.context.env</code></p>
  <h3>Methods</h3>
  <h4><code translate="no">set(name, value, temp, scope)</code></h4>
  <pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.env.set('obj', {name: "Andrew", anotherName: "Homer J Simpson"}, false, 'track');</code></pre>
  <p>Sets the value of the variable by name.</p>
  <ul>
  <li><code translate="no">temp</code> if true, the value will not be captured to the browser local storage. (default: false)</li>
  <li><code translate="no">scope</code> should be set to track to make the data available to other annotations. (default: annotation scope)</li>
  <li>Variables where <code translate="no">scope</code> is <code translate="no">annotation scope</code>, there is no limitation to the data types that can be used.</li>
  </ul>
  <p>Based on the example above, if we wanted to access the data from the the variable <code translate="no">obj</code> we could do so in a text annotation like this:</p>
  <p><img alt="alt text" src="/assets/images/s-brightcove-interactivity-img/developers/OBJ.name+pic.png"></p>
  <p>The variable would resolve after the function is called:
  <img alt="alt text" src="/assets/images/s-brightcove-interactivity-img/developers/resolved+variable.png"></p>
  <h4><code translate="no">get(name)</code></h4>
  <pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.env.get('name')</code></pre>
  <p>Returns the value of the variable by <code translate="no">name</code>.</p>
  <aside class="bcls-aside bcls-aside--information language-editable">Note that <code translate="no">set</code> sets data asynchronously, so if you call <code translate="no">get</code> immediately after <code translate="no">set</code> and before
the <code translate="no">data</code> event fires, the values may be different.</aside>
<p>To return annotation data in current project:</p>
<pre class="line-numbers"><code class="language-javascript" translate="No">hapyak.context.addEventListener("data", function() { //wait for data event to fire
  hapyak.context.env.get('projectAnnotations')
})</code></pre>
<p>Clears the value of a single variable by <code translate="no">name</code>.</p>
<h3>NOTES:</h3>
<p>Any variables set with env.set are changed asynchronously because they need time to be communicated to the parent window. The new value will not be returned by env.get until the next "data" event fires, which should occur within a few milliseconds.</p>
<pre class="line-numbers"><code class="language-javascript" translate="No">console.log(hapyak.context.env.get('myData')); //foo
  hapyak.context.env.set('myData', 'bar');
  console.log(hapyak.context.env.get('myData')); //foo
  hapyak.context.addEventListener('data', function () {
      console.log(hapyak.context.env.get('myData')); //bar
  });</code></pre>
</section>
</article>